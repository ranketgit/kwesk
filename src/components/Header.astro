---
interface SubItem {
  label: string;
  href: string;
}

interface MegaCategory {
  category: string;
  image: string;
  items: {
    label: string;
    href?: string;
    children?: SubItem[];
  }[];
}

const megaMenuData: MegaCategory[] = [
  {
    category: "Bureaux",
    image: "https://images.unsplash.com/photo-1524758631624-e2822e304c36?auto=format&fit=crop&q=80&w=600",
    items: [
      { label: "Bureaux de Direction", href: "/bureaux/direction" },
      { label: "Bureaux Opératifs", href: "/bureaux/operatif" },
      { label: "Bureaux Réglables", href: "/bureaux/reglables" },
      { label: "Bureaux Bench", href: "/bureaux/bench" }
    ]
  },
  {
    category: "Chaises",
    image: "/hero-chairs.png",
    items: [
      { 
        label: "WINNER", 
        children: [
          { label: "WINNER 125", href: "/winner-125" },
          { label: "WINNER C", href: "/winner-c" }
        ]
      },
      { 
        label: "GAMMA", 
        children: [
          { label: "GAMMA 150", href: "/gamma" },
          { label: "GAMMA C", href: "/gamma-c" }
        ]
      },
      { 
        label: "CORPO", 
        children: [{ label: "CORPO 100", href: "/corpo-100" }]
      },
      { 
        label: "BY", 
        children: [
          { label: "BY 100", href: "/by-100" },
          { label: "BY G", href: "/by-g" }
        ]
      },
      { label: "CHALLENGER", href: "/challenger" },
      { 
        label: "EXCLUSIVE", 
        children: [
          { label: "EXCLUSIVE 500", href: "/exclusive" },
          { label: "EXCLUSIVE G", href: "/exclusive-g" }
        ]
      },
      { label: "CADDY", href: "/caddy" }
    ]
  },
  {
    category: "Salle de Réunion",
    image: "https://images.unsplash.com/photo-1431540015161-0bf868a2d407?auto=format&fit=crop&q=80&w=600",
    items: [
      { label: "Tables de Réunion", href: "/reunion/tables" },
      { label: "Chaises de Réunion", href: "/reunion/chaises" },
      { label: "Écrans & Supports", href: "/reunion/media" },
      { label: "Rangements Pro", href: "/reunion/rangement" }
    ]
  }
];

const navItems = [
  { label: "Accueil", href: "/" },
  { label: "Entreprise", href: "/a-propos" },
  { label: "Aménagement", href: "/amenagement-de-bureau" },
  { label: "Nos Produits", href: "#", isMegaTrigger: true },
  { label: "Contact", href: "/contact" },
];
---

<header class="header">
  <div class="header__container">
    <a href="/" class="header__logo">
      <img src="/kwesk-logo.png" class="header__logo-img" alt="KWESK">
    </a>

    <nav class="header__nav ">
      {navItems.map((item) => (
        <div class="header__nav-item">
          {item.isMegaTrigger ? (
            <button class="header__nav-link mega-trigger">
              {item.label}
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </button>
          ) : (
            <a href={item.href} class="header__nav-link">{item.label}</a>
          )}
        </div>
      ))}
    </nav>

    <a href="/contact" class="header__cta">Devis gratuit</a>

    <button class="header__burger" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
  </div>

  <div class="header__mega-panel">
    <div class="header__mega-content">
      {megaMenuData.map((cat) => (
        <div class="header__mega-column">
          <div class="header__mega-image-wrap">
            <img src={cat.image} alt={cat.category} class="header__mega-img" />
            <div class="header__mega-overlay">
              <h3 class="header__mega-title">{cat.category}</h3>
            </div>
          </div>
          
          <div class="header__items-list">
            {cat.items.map((prod) => (
              <div class="header__mega-item">
                {prod.children ? (
                  <>
                    <span class="header__item-label">{prod.label}</span>
                    <div class="header__sub-children">
                      {prod.children.map((child) => (
                        <a href={child.href} class="header__sub-child-link">{child.label}</a>
                      ))}
                    </div>
                  </>
                ) : (
                  <a href={prod.href} class="header__item-label link">{prod.label}</a>
                )}
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>
  </div>

  <div class="header__mobile">
    <nav class="header__mobile-nav">
      {navItems.map((item) => (
        <div class="mobile-nav-block">
          {item.isMegaTrigger ? (
            <>
              <button class="header__mobile-link mobile-trigger">
                {item.label}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
              </button>
              <div class="mobile-accordion-content">
                {megaMenuData.map((cat) => (
                  <div class="mobile-cat-group">
                    <span class="mobile-cat-title">{cat.category}</span>
                    <div class="mobile-cat-links">
                      {cat.items.map((prod) => (
                        <>
                          {prod.href ? (
                            <a href={prod.href} class="mobile-sub-link">{prod.label}</a>
                          ) : (
                            <div class="mobile-prod-cluster">
                              <span class="mobile-cluster-label">{prod.label}</span>
                              <div class="mobile-cluster-subs">
                                {prod.children?.map(c => <a href={c.href} class="mobile-sub-link">{c.label}</a>)}
                              </div>
                            </div>
                          )}
                        </>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            </>
          ) : (
            <a href={item.href} class="header__mobile-link">{item.label}</a>
          )}
        </div>
      ))}
    </nav>
  </div>
</header>

<style>
  .header { position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; }
  .header.scrolled { background-color: white; box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08); }
  
  .header__container {
    max-width: 1400px; margin: 0 auto; padding: 0 60px; height: 100px;
    display: flex; align-items: center; justify-content: space-between; position: relative; z-index: 1001;
  }
  .header.scrolled .header__container { height: 75px; }
  .header__logo-img { height: 40px; }

  .header__nav { display: flex; align-items: center; gap: 40px; }
  .header__nav-link {
    display: flex; align-items: center; gap: 6px; font-size: 14px; font-weight: 600;
    color: white; text-decoration: none; padding: 15px 0; background: none; border: none; cursor: pointer; text-transform: uppercase;
  }
  .header.scrolled .header__nav-link { color: #1c1917; }
  .header__nav-link svg { width: 12px; transition: transform 0.3s; }

  .header__mega-panel {
    position: absolute; top: 90px; left: 40px; right: 40px;
    background: white; box-shadow: 0 40px 80px rgba(0,0,0,0.15); border-radius: 24px; border: 1px solid #f0f0f0;
    opacity: 0; visibility: hidden; transform: translateY(15px); transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
    overflow: hidden;
  }
  .header.scrolled .header__mega-panel { top: 70px; }
  .header:has(.mega-trigger:hover) .header__mega-panel, .header__mega-panel:hover { opacity: 1; visibility: visible; transform: translateY(0); }

  .header__mega-content { padding: 40px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; }
  .header__mega-column { display: flex; flex-direction: column; gap: 24px; border-right: 1px solid #f5f5f4; padding-right: 15px; }
  .header__mega-column:last-child { border-right: none; padding-right: 0; }

  .header__mega-image-wrap { position: relative; width: 100%; height: 180px; border-radius: 12px; overflow: hidden; background: #eee; }
  .header__mega-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.6s ease; }
  .header__mega-column:hover .header__mega-img { transform: scale(1.08); }

  .header__mega-overlay { position: absolute; bottom: 0; left: 0; right: 0; padding: 20px; background: linear-gradient(transparent, rgba(0,0,0,0.7)); }
  .header__mega-title { color: white; font-size: 16px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin: 0; }

  .header__items-list { display: grid; grid-template-columns: 1fr; gap: 16px; padding: 0 5px; }
  .header__item-label { font-size: 14px; font-weight: 800; color: #1c1917; text-decoration: none; margin-bottom: 4px; display: block; }
  .header__item-label.link:hover { color: #8b8b4b; }

  .header__sub-children { display: flex; flex-wrap: wrap; gap: 8px; }
  .header__sub-child-link { font-size: 12px; color: #78716c; text-decoration: none; font-weight: 500; padding: 2px 0; }
  .header__sub-child-link:hover { color: #8b8b4b; }

  .header__cta { padding: 10px 24px; background: #1c1917; color: white; border-radius: 50px; text-decoration: none; font-size: 13px; font-weight: 600; }
  .header.scrolled .header__cta { background: #8b8b4b; }

  .header__burger { display: none; flex-direction: column; gap: 5px; background: none; border: none; cursor: pointer; }
  .header__burger span { width: 25px; height: 2px; background: white; }
  .header.scrolled .header__burger span { background: #1c1917; }

  .header__mobile { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: white; z-index: 1100; padding: 100px 24px 40px; display: block; transform: translateX(100%); transition: transform 0.4s ease; overflow-y: auto; }
  .header__mobile.active { transform: translateX(0); }
  .header__mobile-link { display: flex; align-items: center; justify-content: space-between; width: 100%; padding: 18px 0; font-size: 18px; font-weight: 700; color: #1c1917; text-decoration: none; border-bottom: 1px solid #f0f0f0; background: none; border: none; }
  .header__mobile-link svg { width: 16px; transition: transform 0.3s; }
  .header__mobile-link.open svg { transform: rotate(180deg); }

  .mobile-accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out; }
  .mobile-accordion-content.open { max-height: 3000px; }
  .mobile-cat-group { padding: 20px 0; border-bottom: 1px solid #f5f5f4; }
  .mobile-cat-title { font-size: 11px; text-transform: uppercase; color: #8b8b4b; font-weight: 900; letter-spacing: 1.5px; }
  .mobile-cat-links { display: flex; flex-direction: column; gap: 15px; margin-top: 15px; }
  .mobile-sub-link { font-size: 14px; color: #57534e; text-decoration: none; font-weight: 500; }
  .mobile-prod-cluster { display: flex; flex-direction: column; gap: 8px; }
  .mobile-cluster-label { font-size: 15px; font-weight: 700; color: #1c1917; }
  .mobile-cluster-subs { display: flex; flex-wrap: wrap; gap: 10px; padding-left: 10px; border-left: 2px solid #f0f0f0; }

  @media (max-width: 900px) {
    .header__nav, .header__cta { display: none; }
    .header__burger { display: flex; position: relative; z-index: 1200; }
    .header.scrolled .header__container { height: 75px; }
  }
</style>

<script>
  const header = document.querySelector('.header');
  const burger = document.querySelector('.header__burger');
  const mobileMenu = document.querySelector('.header__mobile');
  const mobileTrigger = document.querySelector('.mobile-trigger');
  const mobileAccordion = document.querySelector('.mobile-accordion-content');

  window.addEventListener('scroll', () => {
    if (window.scrollY > 50) {
      header?.classList.add('scrolled');
    } else {
      header?.classList.remove('scrolled');
    }
  });

  burger?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('active');
    document.body.style.overflow = mobileMenu?.classList.contains('active') ? 'hidden' : '';
  });

  mobileTrigger?.addEventListener('click', () => {
    mobileTrigger.classList.toggle('open');
    mobileAccordion?.classList.toggle('open');
  });
</script>